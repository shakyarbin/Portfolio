<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past Papers Selector</title>
    <link rel="icon" type="image/png" sizes="32x32" href="LOGO.png">
    <link rel="icon" type="image/png" sizes="16x16" href="LOGO.png">
    <link rel="shortcut icon" href="LOGO.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: #ffffff;
            --text-color: #333;
            --border-color: #e0e4e8;
            --dropdown-bg: #ffffff;
            --dropdown-hover: #f8f9fa;
            --shadow-color: rgba(0, 0, 0, 0.08);
        }

        [data-theme="dark"] {
            --bg-color: #000000;
            --container-bg: #1e1e1e;
            --text-color: #ffffff;
            --border-color: #2d2d2d;
            --dropdown-bg: #2d2d2d;
            --dropdown-hover: #363636;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 0;
            min-height: 100vh;
            padding: 40px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
            padding-top: 100px;
            padding-bottom: 40px;
            transition: background-color 0.3s ease;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 30px;
            right: 60px;
            width: 80px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 5px;
            box-sizing: border-box;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle::before {
            content: '';
            width: 30px;
            height: 30px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .theme-toggle.dark {
            background: #333;
        }

        .theme-toggle.dark::before {
            transform: translateX(40px);
        }

        .theme-toggle .icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .theme-toggle .sun {
            left: 8px;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .theme-toggle .moon {
            right: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .theme-toggle.dark .sun {
            opacity: 0;
        }

        .theme-toggle.dark .moon {
            opacity: 1;
        }

        .form-container {
            background: var(--container-bg);
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 4px 6px var(--shadow-color);
            transition: all 0.3s ease;
            margin-bottom: 16px;
        }

        .form-container:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .form-group {
            position: relative;
            min-width: 200px;
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .info-icon {
            width: 16px;
            height: 16px;
            background: #e9ecef;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #666;
            cursor: help;
        }

        select, input {
            width: 100%;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            background-color: var(--dropdown-bg);
            color: var(--text-color);
            cursor: pointer;
            appearance: none;
            font-size: 14px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        select {
            padding-right: 36px;
        }

        .form-group::after {
            content: '‚ñæ';
            font-size: 16px;
            color: var(--text-color);
            position: absolute;
            right: 12px;
            top: 38px;
            pointer-events: none;
            opacity: 0.5;
        }

        select:hover, input:hover {
            border-color: #4a90e2;
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        select:focus, input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.15);
        }

        .button-container {
            flex-basis: 100%;
            margin-top: 32px;
            display: flex;
            justify-content: flex-end;
            gap: 16px;
        }

        .youtube-button {
            background-color: #FF0000;
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .youtube-button:hover {
            background-color: #CC0000;
            transform: translateY(-1px);
        }

        .youtube-button i {
            font-size: 18px;
        }

        button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.7;
            background: none;
            transform: none;
            box-shadow: none;
        }

        /* Add styles for history section */
        .history-container {
            flex: 3;
            min-width: 850px;
            background: var(--container-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px var(--shadow-color);
            padding: 24px 24px 24px 16px;
            transition: all 0.3s ease;
            margin-bottom: 0;
            margin-left: 35px;
        }

        .history-container:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .history-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-color);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th,
        .history-table td {
            padding: 16px 16px 16px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .history-table th:first-child,
        .history-table td:first-child {
            padding-left: 4px;
        }

        .history-table th {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .history-table tr {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .history-table tr:hover {
            background-color: var(--dropdown-hover);
        }

        .history-link {
            color: #4a90e2;
            text-decoration: none;
        }

        .history-link:hover {
            text-decoration: underline;
        }

        .no-history {
            text-align: center;
            padding: 20px;
            color: var(--text-color);
            opacity: 0.7;
        }

        .subject-icon {
            margin-right: 12px;
            color: #4a90e2;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .reset-button {
            background-color: #dc3545;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .reset-button:hover {
            background-color: #c82333;
            transform: translateY(-1px);
        }

        .delete-item {
            color: #dc3545;
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            font-size: 14px;
            opacity: 0.7;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .delete-item:hover {
            opacity: 1;
            transform: scale(1.1);
            background: none;
        }

        .history-table tr td:last-child {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding-right: 8px;
        }

        .countdown-section {
            width: min(90%, 1200px);
            margin: 0 auto;
            display: flex;
            gap: 120px;
            padding: 0 8px;
            margin-left: 40px;
        }

        .countdown-container {
            width: 350px;
            height: 280px;
            perspective: 2000px;
            cursor: pointer;
            margin: 0 auto;
            margin-bottom: 16px;
            position: relative;
        }

        .countdown-container.flipped .countdown-flip-card {
            transform: rotateY(180deg);
        }

        .countdown-flip-card {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            transform-origin: 50% 50%;
        }

        .countdown-front, .countdown-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background: var(--container-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px var(--shadow-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 28px;
            box-sizing: border-box;
        }

        .countdown-back {
            transform: rotateY(180deg);
        }

        .flip-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 16px;
            opacity: 0.5;
            transition: opacity 0.2s;
            color: var(--text-color);
        }

        .countdown-container:hover .flip-icon {
            opacity: 1;
        }

        .countdown-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 24px;
        }

        .countdown-number {
            font-size: 64px;
            font-weight: 600;
            color: #4a90e2;
            line-height: 1;
            margin-bottom: 24px;
        }

        .countdown-details {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.6;
        }

        .history-table td i {
            margin-right: 8px;
        }

        /* Style for subject icons in dark mode */
        [data-theme="dark"] .subject-icon {
            color: #6ba4e2;
        }

        select#subjectCode {
            font-size: 14px;
            color: var(--text-color);
        }

        select#subjectCode option {
            padding: 8px 12px;
            font-size: 14px;
        }

        .calendar-container {
            flex: 1;
            background: var(--container-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px var(--shadow-color);
            padding: 16px;
            transition: all 0.3s ease;
            width: 330px;
            margin-top: 0;
            margin-left: 50px;
            height: fit-content;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 0;
        }

        .calendar-title {
            font-size: 16px;
            font-weight: 500;
            margin: 0;
            color: var(--text-color);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 4px;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            padding: 0;
            margin: 0;
            grid-auto-rows: minmax(32px, auto);
        }

        .calendar-day {
            position: relative;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            border-radius: 50%;
            color: var(--text-color);
            transition: all 0.2s;
            margin: 0;
            background: none;
        }

        .calendar-day:hover {
            opacity: 0.9;
        }

        .calendar-day.highlighted {
            background-color: #4a90e2; /* Blue color for all final exams */
            color: white;
            font-weight: 500;
        }

        .calendar-day.current {
            background-color: #2ecc71; /* Green background for current date */
            color: white;
            font-weight: 600;
            border: 2px solid #27ae60; /* Darker green border */
        }

        .calendar-day.current:hover {
            opacity: 1;
            background-color: #27ae60; /* Darker green on hover */
        }

        /* Update the highlighted and mock styles to handle current date overlap */
        .calendar-day.current.highlighted {
            background-color: #4a90e2;
            border-color: #357abd;
        }

        .calendar-day.current.mock {
            background-color: #9c27b0;
            border-color: #7b1fa2;
        }

        .calendar-day.mock {
            background-color: #9c27b0; /* Keep purple for mock exam */
            color: white;
            font-weight: 500;
        }

        /* Remove individual subject colors */
        .calendar-day[data-subject="Physics"],
        .calendar-day[data-subject="Chemistry"],
        .calendar-day[data-subject="Mathematics"],
        .calendar-day[data-subject="Computer Science"],
        .calendar-day[data-subject="EGP"] {
            background-color: #4a90e2; /* Same blue for all subjects */
            color: white;
        }

        .calendar-nav {
            width: 28px;
            height: 28px;
            font-size: 20px;
            opacity: 0.7;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
            padding: 0;
        }

        .calendar-nav:hover {
            opacity: 1;
            background: none;
        }

        .calendar-nav:focus, 
        .calendar-nav:active {
            background: none;
            outline: none;
        }

        .calendar-day.disabled {
            opacity: 0.3;
            cursor: default;
        }

        .calendar-day.exam {
            background-color: #ff5722;
            color: white;
        }

        .calendar-day.deadline {
            background-color: #ffc107;
            color: black;
        }

        .date-tooltip {
            position: absolute;
            background: var(--container-bg);
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            width: max-content;
            max-width: 200px;
            opacity: 0;
            visibility: hidden;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            text-align: left;
            border: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-color);
            pointer-events: none;
            transition: opacity 0.2s, visibility 0.2s;
            white-space: nowrap;
        }

        .date-tooltip div {
            margin: 4px 0;
            white-space: nowrap;
        }

        .date-tooltip div:not(:last-child) {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 4px;
        }

        .calendar-day:hover .date-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .time-calendar-container {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
            padding-right: 8px;
            margin-left: -80px;
        }

        .manual-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .help-button::before {
            content: '‚å®Ô∏è';
            font-size: 18px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            line-height: 1;
        }

        .help-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: #f8f9fa;
        }

        /* Add dark mode styles */
        [data-theme="dark"] .help-button {
            background: #2d2d2d;
            border-color: #404040;
            color: white;
        }

        [data-theme="dark"] .help-button:hover {
            background: #363636;
        }

        .manual-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .manual-content {
            background: var(--container-bg);
            padding: 24px;
            border-radius: 12px;
            width: 320px;
            position: relative;
        }

        .manual-content h3 {
            margin: 0 0 20px 0;
            color: var(--text-color);
            font-size: 18px;
            font-weight: 500;
        }

        .shortcut-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: var(--text-color);
        }

        .key {
            background: var(--border-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-family: monospace;
        }

        .close-manual {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .close-manual:hover {
            opacity: 1;
        }

        /* Add responsive styles */
        @media screen and (max-width: 1024px) {
            .countdown-section {
                flex-direction: column;
                gap: 32px;
                width: 95%;
            }

            .history-container {
                min-width: unset;
                width: 100%;
                overflow-x: auto;
            }

            .time-calendar-container {
                margin-left: 0;
                padding-right: 0;
                width: 100%;
            }

            .countdown-container {
                width: 100%;
                max-width: 350px;
                margin: 0 auto;
            }

            .calendar-container {
                width: 100%;
                max-width: 340px;
                margin: 0 auto;
                margin-left: 0;
            }

            .form-container {
                padding: 20px;
            }

            .form-group {
                min-width: 150px;
            }

            .button-container {
                justify-content: center;
            }

            /* Adjust table for mobile */
            .history-table {
                min-width: 800px; /* To ensure horizontal scroll on mobile */
            }

            .history-table th,
            .history-table td {
                padding: 12px 8px;
                font-size: 13px;
            }

            /* Adjust body padding */
            body {
                padding: 20px;
                padding-top: 80px;
            }

            /* Adjust theme toggle position */
            .theme-toggle {
                top: 20px;
                right: 20px;
            }
        }

        /* Additional adjustments for very small screens */
        @media screen and (max-width: 480px) {
            .form-container {
                padding: 16px;
            }

            .form-group {
                flex: 1 1 100%; /* Stack form elements vertically */
            }

            .button-container {
                flex-direction: column;
                gap: 12px;
            }

            .youtube-button,
            #submitButton {
                width: 100%;
            }
        }

        /* Update the submit button styles */
        #submitButton {
            background-color: #2ecc71;
            color: white;
            padding: 10px 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        #submitButton:hover {
            background-color: #27ae60;
            transform: translateY(-1px);
        }

        /* Update dark mode styles */
        [data-theme="dark"] #submitButton {
            background-color: #2ecc71;
            color: white;
        }

        [data-theme="dark"] #submitButton:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="theme-toggle" id="themeToggle">
        <span class="icon sun">‚òÄÔ∏è</span>
        <span class="icon moon">üåô</span>
    </div>

    <div class="form-container">
        <div class="form-group">
            <label for="subjectCode">Subject <span class="info-icon" tabindex="-1">?</span></label>
            <select id="subjectCode" tabindex="1" onkeydown="handleKeyDown(event, 'component')">
                <option value="9702">üçè Physics</option>
                <option value="9701">üß™ Chemistry</option>
                <option value="9618">üíª Computer Science</option>
                <option value="9608">üíª Computer (before 2021)</option>
                <option value="9709">üìê Mathematics</option>
                <option value="8021">üìñ English General Paper</option>
            </select>
        </div>

        <div class="form-group">
            <label for="component">Component</label>
            <input type="text" id="component" tabindex="2" onkeydown="handleKeyDown(event, 'session')" placeholder="Enter component">
        </div>

        <div class="form-group">
            <label for="session">Session <span class="info-icon" tabindex="-1">?</span></label>
            <select id="session" tabindex="3" onkeydown="handleKeyDown(event, 'year')">
                <option value="s">May/June</option>
                <option value="w">October/November</option>
            </select>
        </div>

        <div class="form-group">
            <label for="year">Year</label>
            <select id="year" tabindex="4" onkeydown="handleKeyDown(event, 'paperType')">
                <!-- Years will be populated by JavaScript -->
            </select>
        </div>

        <div class="form-group">
            <label for="paperType">Paper Type</label>
            <select id="paperType" tabindex="5" onkeydown="handleKeyDown(event, 'submitButton')">
                <option value="ms">Marking Scheme (ms)</option>
                <option value="qp">Question Paper (qp)</option>
                <option value="in">Insert (in)</option>
                <option value="sf">Source File (sf)</option>
            </select>
        </div>

        <div class="button-container">
            <button id="youtubeButton" tabindex="6" onclick="searchYoutube()" class="youtube-button">
                <i class="fa-brands fa-youtube"></i> YouTube
            </button>
            <button id="submitButton" tabindex="7" onclick="openPastPaper()" onkeydown="handleKeyDown(event, null)">
                Open Past Paper
            </button>
        </div>
    </div>

    <div class="countdown-section">
        <div class="history-container">
            <div class="history-header">
                <h2 class="history-title">Search History</h2>
                <button class="reset-button" onclick="clearHistory()">Clear All History</button>
            </div>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Component</th>
                        <th>Session</th>
                        <th>Year</th>
                        <th>Type</th>
                        <th>Date Searched</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <!-- History items will be populated here -->
                </tbody>
            </table>
        </div>
        
        <div class="time-calendar-container">
            <div class="countdown-container" onclick="flipCard()">
                <div class="countdown-flip-card">
                    <div class="countdown-front">
                        <i class="fas fa-sync-alt flip-icon"></i>
                        <h2 class="countdown-title">Boards</h2>
                        <div class="countdown-number" id="daysLeft">69</div>
                        <div class="countdown-details" id="timeDetails">4 hours 44 minutes remaining</div>
                    </div>
                    <div class="countdown-back">
                        <i class="fas fa-sync-alt flip-icon"></i>
                        <h2 class="countdown-title">Mock Exam</h2>
                        <div class="countdown-number" id="mockDaysLeft">--</div>
                        <div class="countdown-details" id="mockTimeDetails">-- hours -- minutes remaining</div>
                    </div>
                </div>
            </div>
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="changeMonth(-1)">‚Äπ</button>
                    <h2 class="calendar-title" id="calendarTitle"></h2>
                    <button class="calendar-nav" onclick="changeMonth(1)">‚Ä∫</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-weekdays">
                        <span>SUN</span>
                        <span>MON</span>
                        <span>TUE</span>
                        <span>WED</span>
                        <span>THU</span>
                        <span>FRI</span>
                        <span>SAT</span>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                        <!-- Days will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="manual-button" id="manualButton">
        <button class="help-button" onclick="toggleManual()"></button>
    </div>

    <div class="manual-overlay" id="manualOverlay">
        <div class="manual-content">
            <h3>Keyboard Shortcuts</h3>
            <div class="shortcut-list">
                <div class="shortcut-item">
                    <span class="key">Tab</span>
                    <span>Move to next field</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">Enter</span>
                    <span>Select option / Open paper</span>
                </div>
                <div class="shortcut-item">
                    <span class="key">‚Üë/‚Üì</span>
                    <span>Navigate dropdown options</span>
                </div>
            </div>
            <button class="close-manual" onclick="toggleManual()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // Populate years dropdown when page loads
        window.onload = function() {
            const yearSelect = document.getElementById('year');
            const currentYear = 2024; // Set maximum year to 2024
            
            for (let year = currentYear; year >= 2000; year--) {
                const option = document.createElement('option');
                option.value = year.toString().slice(-2); // Value will be last 2 digits
                option.textContent = year; // Display full year
                yearSelect.appendChild(option);
            }
            
            // Update history table
            updateHistoryTable();

            // Focus the first input on page load
            document.getElementById('subjectCode').focus();
        };

        function openPastPaper() {
            const subjectCode = document.getElementById('subjectCode').value;
            const component = document.getElementById('component').value;
            const session = document.getElementById('session').value;
            const year = document.getElementById('year').value;
            const paperType = document.getElementById('paperType').value;

            // Save to history
            saveToHistory({ subjectCode, component, session, year, paperType });

            let url;
            if (paperType === 'sf') {
                // Construct source file URL for Computer Science
                const sessionText = session === 's' ? 'may-june' : 'oct-nov';
                const yearFull = `20${year}`;
                url = `https://pastpapers.papacambridge.com/papers/caie/as-and-a-level-computer-science-for-first-examination-in-2021-${subjectCode}-${yearFull}-${sessionText}`;
            } else if (paperType === 'in') {
                // Construct insert paper URL
                url = `https://pastpapers.papacambridge.com/directories/CAIE/CAIE-pastpapers/upload/${subjectCode}_${session}${year}_${paperType}_${component}.pdf`;
            } else {
                // Construct regular past paper URL
                url = `https://pastpapers.papacambridge.com/directories/CAIE/CAIE-pastpapers/upload/${subjectCode}_${session}${year}_${paperType}_${component}.pdf`;
            }

            window.open(url, '_blank');
            document.getElementById('subjectCode').focus();
        }

        // Update theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            if (savedTheme === 'dark') {
                themeToggle.classList.add('dark');
            }
        }

        themeToggle.addEventListener('click', function() {
            this.classList.toggle('dark');
            const isDark = this.classList.contains('dark');
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        function saveToHistory(search) {
            let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            history.unshift({
                ...search,
                timestamp: new Date().toISOString()
            });
            // Keep only last 10 searches
            history = history.slice(0, 10);
            localStorage.setItem('searchHistory', JSON.stringify(history));
            updateHistoryTable();
        }

        function getSubjectName(code) {
            const subjects = {
                '9702': 'üçè Physics',
                '9701': 'üß™ Chemistry',
                '9618': 'üíª Computer Science',
                '9608': 'üíª Computer (before 2021)',
                '9709': 'üìê Mathematics',
                '8021': 'üìñ English General Paper'
            };
            return subjects[code] || code;
        }

        function updateHistoryTable() {
            const historyTableBody = document.getElementById('historyTableBody');
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            
            if (history.length === 0) {
                historyTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-history">No search history yet</td>
                    </tr>
                `;
                return;
            }

            historyTableBody.innerHTML = history.map((item, index) => `
                <tr onclick="openHistoryItem('${item.subjectCode}', '${item.component}', '${item.session}', '${item.year}', '${item.paperType}')">
                    <td>${getSubjectName(item.subjectCode)}</td>
                    <td>${item.component}</td>
                    <td>${item.session === 's' ? 'May/June' : 'October/November'}</td>
                    <td>20${item.year}</td>
                    <td>${item.paperType.toUpperCase()}</td>
                    <td>
                        <span>${new Date(item.timestamp).toLocaleString()}</span>
                        <button class="delete-item" onclick="deleteHistoryItem(${index}, event)">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function openHistoryItem(subjectCode, component, session, year, paperType) {
            const url = `https://pastpapers.papacambridge.com/directories/CAIE/CAIE-pastpapers/upload/${subjectCode}_${session}${year}_${paperType}_${component}.pdf`;
            window.open(url, '_blank');
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all history?')) {
                localStorage.removeItem('searchHistory');
                updateHistoryTable();
            }
        }

        function deleteHistoryItem(index, event) {
            event.stopPropagation(); // Prevent opening the PDF when clicking delete
            let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            history.splice(index, 1);
            localStorage.setItem('searchHistory', JSON.stringify(history));
            updateHistoryTable();
        }

        function updateCountdown() {
            // Final exam countdown
            const finalDate = new Date('2025-04-29T00:00:00');
            const mockDate = new Date('2025-03-17T00:00:00');
            const now = new Date();
            
            // Calculate final exam countdown
            const finalDifference = finalDate - now;
            const finalDays = Math.floor(finalDifference / (1000 * 60 * 60 * 24));
            const finalHours = Math.floor((finalDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const finalMinutes = Math.floor((finalDifference % (1000 * 60 * 60)) / (1000 * 60));

            // Calculate mock exam countdown
            const mockDifference = mockDate - now;
            const mockDays = Math.floor(mockDifference / (1000 * 60 * 60 * 24));
            const mockHours = Math.floor((mockDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const mockMinutes = Math.floor((mockDifference % (1000 * 60 * 60)) / (1000 * 60));

            // Update final exam display
            document.getElementById('daysLeft').textContent = finalDays;
            document.getElementById('timeDetails').textContent = 
                `${finalHours} hours ${finalMinutes} minutes remaining`;

            // Update mock exam display
            document.getElementById('mockDaysLeft').textContent = mockDays;
            document.getElementById('mockTimeDetails').textContent = 
                `${mockHours} hours ${mockMinutes} minutes remaining`;
        }

        // Update countdown immediately and then every minute
        updateCountdown();
        setInterval(updateCountdown, 60000);

        function handleKeyDown(event, nextElementId) {
            // If Enter is pressed
            if (event.key === 'Enter') {
                event.preventDefault();
                openPastPaper();
                return;
            }
            // If Tab is pressed
            else if (event.key === 'Tab' && !event.shiftKey) {
                event.preventDefault();
                // Skip submitButton and cycle back to first field
                if (nextElementId === 'submitButton') {
                    document.getElementById('subjectCode').focus();
                    return;
                }
                if (nextElementId) {
                    document.getElementById(nextElementId).focus();
                }
            }
            // Handle left/right arrow keys for navigation between fields
            else if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                const fields = ['subjectCode', 'component', 'session', 'year', 'paperType'];
                const currentIndex = fields.indexOf(event.target.id);
                
                if (currentIndex !== -1) {
                    event.preventDefault();
                    let newIndex;
                    
                    if (event.key === 'ArrowLeft') {
                        newIndex = currentIndex > 0 ? currentIndex - 1 : fields.length - 1;
                    } else {
                        newIndex = currentIndex < fields.length - 1 ? currentIndex + 1 : 0;
                    }
                    
                    document.getElementById(fields[newIndex]).focus();
                }
            }
            // Let up/down arrows handle dropdown selection
            else if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                if (event.target.tagName === 'SELECT') {
                    event.target.dataset.arrowSelection = true;
                }
            }
        }

        // Update the dropdown handlers
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', function() {
                // Don't automatically move focus on arrow key selection
                if (!this.dataset.arrowSelection) {
                    const nextId = this.getAttribute('onkeydown').match(/'([^']+)'/)[1];
                    if (nextId) {
                        document.getElementById(nextId).focus();
                    }
                }
                this.dataset.arrowSelection = false;
            });

            // Track if change was triggered by arrow keys
            select.addEventListener('keydown', function(e) {
                if (e.key.startsWith('Arrow')) {
                    this.dataset.arrowSelection = true;
                }
            });
        });

        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // Update the importantDates array
        const importantDates = [
            // Mock Exam Period
            { 
                date: new Date(2025, 2, 17),
                type: 'exam',
                subject: 'Maths P32',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 17),
                type: 'exam',
                subject: 'Maths P42',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 19),
                type: 'exam',
                subject: 'Physics 42',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 19),
                type: 'exam',
                subject: 'Physics 52',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 23),
                type: 'exam',
                subject: 'Computer 42',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 24),
                type: 'exam',
                subject: 'Computer P32',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 27),
                type: 'exam',
                subject: 'Chemistry P42',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 27),
                type: 'exam',
                subject: 'Chemistry P52',
                details: 'Mock Exam'
            },
            { 
                date: new Date(2025, 2, 28), // March 28
                type: 'exam',
                subject: 'EGP P12',
                details: 'Mock Exam End'
            },
            { 
                date: new Date(2025, 2, 28), // March 28
                type: 'exam',
                subject: 'EGP P22',
                details: 'Mock Exam End'
            },
            // Final Exams
            { 
                date: new Date(2025, 3, 29), // April 29
                type: 'exam',
                subject: 'EGP',
                details: 'EGP P1'
            },
            {
                date: new Date(2025, 4, 5), // May 5
                type: 'exam',
                subject: 'EGP',
                details: 'EGP P2'
            },
            {
                date: new Date(2025, 4, 7), // May 7
                type: 'exam',
                subject: 'Mathematics',
                details: 'Maths P4'
            },
            {
                date: new Date(2025, 4, 9), // May 9
                type: 'exam',
                subject: 'Chemistry',
                details: 'Chemistry P4'
            },
            {
                date: new Date(2025, 4, 9), // May 9
                type: 'exam',
                subject: 'Physics',
                details: 'Physics P4'
            },
            {
                date: new Date(2025, 4, 19), // May 19
                type: 'exam',
                subject: 'Chemistry',
                details: 'Chemistry P5'
            },
            {
                date: new Date(2025, 4, 19), // May 19
                type: 'exam',
                subject: 'Mathematics',
                details: 'Maths P3'
            },
            {
                date: new Date(2025, 4, 20), // May 20
                type: 'exam',
                subject: 'Physics',
                details: 'Physics P5'
            },
            {
                date: new Date(2025, 4, 21), // May 21
                type: 'exam',
                subject: 'Computer Science',
                details: 'Computer P3'
            },
            {
                date: new Date(2025, 4, 23), // May 23
                type: 'exam',
                subject: 'Computer Science',
                details: 'Computer P4'
            }
        ];

        // Add this function to show date details
        function showDateDetails(date, details) {
            const tooltip = document.createElement('div');
            tooltip.className = 'date-tooltip';
            tooltip.innerHTML = `
                <strong>${details.subject}</strong>
                <p>${details.details}</p>
            `;
            // Add tooltip functionality here
        }

        function formatMonth(year, month) {
            return new Intl.DateTimeFormat('en-US', { 
                year: 'numeric', 
                month: 'long' 
            }).format(new Date(year, month));
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentYear, currentMonth);
        }

        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay();
            const monthLength = lastDay.getDate();
            
            // Update calendar title
            document.getElementById('calendarTitle').textContent = formatMonth(year, month);
            
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day disabled';
                calendarDays.appendChild(emptyDay);
            }

            // Add the days of the month
            for (let i = 1; i <= monthLength; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = i;

                const currentDateString = new Date(year, month, i).toDateString();
                
                // Check if it's today
                if (new Date().toDateString() === currentDateString) {
                    dayElement.classList.add('current');
                }

                // Check if it's an important date
                const importantDate = importantDates.find(date => 
                    date.date.toDateString() === currentDateString
                );
                
                if (importantDate) {
                    dayElement.classList.add('highlighted');
                    if (importantDate.subject === 'Mock') {
                        dayElement.classList.add('mock');
                    } else {
                        dayElement.setAttribute('data-subject', importantDate.subject);
                    }
                    
                    // Find all events for this date
                    const allEventsForDate = importantDates.filter(date => 
                        date.date.toDateString() === currentDateString
                    );
                    
                    // Create tooltip with subject (for Mock) or details (for Finals)
                    const tooltip = document.createElement('div');
                    tooltip.className = 'date-tooltip';
                    tooltip.innerHTML = allEventsForDate.map(event => {
                        if (event.date >= new Date(2025, 3, 29)) { // April 29th and after are Finals
                            return `<div>${event.details}</div>`;
                        } else {
                            return `<div>${event.subject}</div>`;
                        }
                    }).join('');
                    dayElement.appendChild(tooltip);
                }

                // Remove click event handler
                calendarDays.appendChild(dayElement);
            }
        }

        // Add these variables at the start of your JavaScript
        let touchStartX = 0;
        let touchEndX = 0;

        // Add these event listeners after the calendar initialization
        function initializeSwipeEvents() {
            const calendarContainer = document.querySelector('.calendar-container');
            
            calendarContainer.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
            }, false);

            calendarContainer.addEventListener('touchmove', (e) => {
                e.preventDefault(); // Prevent scrolling while swiping
            }, false);

            calendarContainer.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].clientX;
                handleSwipe();
            }, false);
        }

        function handleSwipe() {
            const swipeThreshold = 50; // Minimum distance for a swipe
            const swipeDistance = touchEndX - touchStartX;
            
            if (Math.abs(swipeDistance) > swipeThreshold) {
                if (swipeDistance > 0) {
                    // Swipe right - previous month
                    changeMonth(-1);
                } else {
                    // Swipe left - next month
                    changeMonth(1);
                }
            }
        }

        // Update the window.addEventListener('load') function
        window.addEventListener('load', () => {
            generateCalendar(currentYear, currentMonth);
            initializeSwipeEvents();
        });

        function toggleManual() {
            const overlay = document.getElementById('manualOverlay');
            overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
        }

        // Close manual when clicking outside
        document.getElementById('manualOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                toggleManual();
            }
        });

        function searchYoutube() {
            const subjectCode = document.getElementById('subjectCode').value;
            const component = document.getElementById('component').value;
            const session = document.getElementById('session').value;
            const year = document.getElementById('year').value;
            
            // Format the search query in the specified format: 9701/12/m/j/24
            const formattedSession = session === 's' ? 'm/j' : 'o/n';
            const searchQuery = `${subjectCode}/${component}/${formattedSession}/${year}`;
            
            // Create YouTube search URL
            const youtubeURL = `https://www.youtube.com/results?search_query=${encodeURIComponent(searchQuery)}`;
            
            // Copy URL to clipboard silently
            navigator.clipboard.writeText(youtubeURL);
            
            // Open YouTube in new tab
            window.open(youtubeURL, '_blank');
        }

        function flipCard() {
            const container = document.querySelector('.countdown-container');
            container.classList.toggle('flipped');
        }
    </script>
</body>
</html> 